# Developer Guide: Interactive Philippine Map

This document outlines a design guideline for your interactive Philippine map web application, focusing on modularity and scalability.

### **1. Project Structure**

To keep your code organized and scalable, I recommend the following file structure within the `src` directory:

```
src/
├───data/
│   ├───ph.json             # GeoJSON for the map
│   └───region_data.json    # Sample data for regions (e.g., population, etc.)
├───js/
│   ├───map.js              # Your existing map initialization
│   ├───filter.js           # (New) Logic for the filter panel

│   └───script.js           # Main script to connect everything
└───styles/
    └───style.css           # Main styles for your layout and components
```

### **2. HTML (`index.html`)**

Your HTML body can be structured with simple `div` containers for each main component.

```html
<body>
    <div id="app">
        <div id="map-container">
            <div id="map"></div>
        </div>
        <div id="filter-panel" class="panel">
            <!-- Filter controls will be generated by filter.js -->
        </div>
    </div>
    <script src="https://unpkg.com/maplibre-gl@4.1.0/dist/maplibre-gl.js"></script>
    <script type="module" src="src/js/script.js"></script>
</body>
```

### **3. Responsive Design with Materialize CSS**

To make the application mobile-ready and provide ready-made UI components, Materialize CSS has been integrated. This framework offers a responsive grid system, pre-designed elements like navigation bars and side panels, and is free and easy to use via CDN.

**Integration Details:**

*   **CDN Links:** Materialize CSS, JavaScript, and Material Icons have been added to the `<head>` and `<body>` of `index.html`.
*   **Header (Navbar):** A `<header>` element containing a Materialize `nav` component was introduced. This serves as the application's header, displaying the title and a "hamburger" icon (`sidenav-trigger`) for mobile navigation.
*   **Side Panel (Sidenav):** A Materialize `ul` with the class `sidenav` and `id="slide-out"` was created. Your existing `#filter-panel` and `#info-panel` elements were moved inside this sidenav. On mobile, these panels will now slide out from the side when the menu icon is tapped.
*   **Main Content:** The `#map-container` is now wrapped in a `<main>` tag for better semantic structure.
*   **JavaScript Initialization:** A small JavaScript snippet was added at the end of `<body>` to initialize the Materialize Sidenav component, ensuring its interactive functionality.

**Updated HTML Structure (Conceptual):**

```html
<!DOCTYPE html>
<html>
<head>
    <!-- Materialize CSS, Icons, and other links -->
</head>
<body>
    <header>
        <nav>
            <div class="nav-wrapper">
                <a href="#" class="brand-logo center">Philippine Map</a>
                <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
            </div>
        </nav>
    </header>

    <ul id="slide-out" class="sidenav">
        <li><div id="filter-panel" class="panel">...</div></li>
    </ul>

    <main>
        <div id="app">
            <div id="map-container">
                <div id="map"></div>
            </div>
        </div>
    </main>

    <!-- MapLibre JS, Materialize JS, script.js, and Sidenav initialization script -->
</body>
</html>
```

### **4. CSS (`src/styles/style.css`)**

Use a modern layout like CSS Grid or Flexbox to position your components. Here’s a simple example using Flexbox to place the panels over the map.

```css
body {
    margin: 0;
    font-family: sans-serif;
}

#app {
    display: flex;
    position: relative;
    height: 100vh;
}

#map-container {
    flex-grow: 1;
}

#map {
    width: 100%;
    height: 100%;
}

.panel {
    position: absolute;
    top: 20px;
    background: white;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    z-index: 1;
    max-height: 90vh;
    overflow-y: auto;
}

#filter-panel {
    left: 20px;
}


```

### **5. JavaScript Modules (`src/js/`)**

This is how the JavaScript modules would work together:

**`script.js` (The Conductor)**

This file imports all other modules and makes them work together.

*   **Responsibility:**
    1.  Initialize the map.
    2.  Load the regional data.
    3.  Initialize the filter panel with the loaded data.
    4.  Listen for events (e.g., a filter change from `filter.js` or a region click from `map.js`).


**`color.js` (The Color Palette)**

This module provides utilities for managing and applying colors to map regions.

*   **Responsibility:**
    1.  Define a function to dynamically set the color of a specific map region.
    2.  Export a Mapbox GL JS style expression for assigning default colors to regions based on their names.

**`map.js` (The Map)**

*   **Responsibility:**
    1.  Initialize and configure the MapLibre instance (as you've done).
    2.  (New) Add functions to interact with the map, like changing the color of a region or adding a click listener. For example:
        ```javascript
        // In map.js, you could add a function like this
        export function setRegionColor(regionId, color) {
            map.setPaintProperty(regionId, 'fill-color', color);
        }
        ```

**`filter.js` (The Controls)**

*   **Responsibility:**
    1.  Fetch and render the filter options (e.g., from a JSON file).
    2.  Create the UI for the filters (e.g., checkboxes, dropdowns).
    3.  When a user interacts with a filter, it notifies `script.js` about the change. You can use custom events for this.



This design keeps each part of your application separate and focused on a single job, which will make it much easier to manage and expand in the future.

### **6. Testing Your JavaScript**

To ensure the reliability and correctness of your JavaScript logic without introducing external dependencies, a lightweight, vanilla JavaScript testing setup has been implemented. This allows you to write and run tests directly in your browser.

**Components:**

*   **`tests.html`**: Located in the project root, this HTML file serves as your test runner. Opening it in a web browser will execute all included test files and display the results.
*   **`src/tests/test-helpers.js`**: This file provides simple assertion utilities (`it`, `assert`, `assertEqual`) to structure your tests.
*   **Test Files (e.g., `src/tests/filter.test.js`)**: These files contain your actual test cases, utilizing the `it()` function to define individual tests and the assertion functions to verify expected behavior.

**How to Run Tests:**

1.  Open `tests.html` in your web browser.
2.  The results (pass/fail) will be displayed directly on the page.

**How to Write New Tests:**

1.  Create a new test file in `src/tests/` (e.g., `src/tests/map.test.js`).
2.  Use the `it()` function to define a test block, providing a description and a callback function containing your test logic:

    ```javascript
    // Example: src/tests/map.test.js
    it('should correctly initialize the map with default settings', () => {
      // Assume a map initialization function exists in map.js
      // const mapInstance = initializeMap();
      // assertEqual(mapInstance.getZoom(), 10);
      // assert(mapInstance.isLoaded());
      assert(true); // Placeholder assertion
    });
    ```

3.  Include your new test file in `tests.html` by adding a `<script>` tag:

    ```html
    <!-- In tests.html -->
    <script src="src/tests/filter.test.js"></script>
    <script src="src/tests/map.test.js"></script> <!-- Add this line -->
    ```

This setup provides a straightforward way to maintain code quality and catch regressions as your application evolves.

### **7. Interaction Example: Clicking a Region**

Here’s how the modules would work together when a user clicks on a region to see more information:

1.  **The User Clicks a Region on the Map.**

2.  **`map.js` Handles the Click and Notifies Others.**
    *   It listens for a `click` event on the map's region layer.
    *   Instead of directly showing an info box, it dispatches a custom event (e.g., `regionClick`) to announce that a region was clicked. This keeps the map module decoupled from the info panel.

    ```javascript
    // In map.js, inside your map initialization
    map.on('click', 'your-region-layer-name', (e) => {
        const regionId = e.features[0].properties.ID; // Or however you get the ID
        const event = new CustomEvent('regionClick', { detail: { regionId } });
        map.getCanvas().dispatchEvent(event);
    });
    ```

3.  **`script.js` Orchestrates the Response.**
    *   It listens for the `regionClick` event.
    *   When the event is caught, it finds the corresponding data for the clicked region.
    

    ```javascript
    // In script.js
    

    // ... after data is loaded ...
    const mapCanvas = map.getCanvas();
    mapCanvas.addEventListener('regionClick', (e) => {
        const { regionId } = e.detail;
        const regionData = allData.find(r => r.id === regionId);

        if (regionData) {
            const content = `<h3>${regionData.name}</h3><p>Details about the region...</p>`;

        }
    });
    ```




### **8. Data Consistency Tests**

To ensure data integrity across different data sources, specific tests are in place.

**Region Name Consistency (`src/tests/regionNames.test.js`)**

This test verifies that the administrative region names are consistent between `ph_updated_nir.json` (which provides geographic data) and `ph-pi-rate.json` (which contains poverty rate data). It confirms that every region listed in one file exists in the other, preventing mismatches when data from both sources is combined.